<?xml version="1.0" encoding="UTF-8" ?>

<!-- **************************************** -->
<!-- net-petri definition -->
<!-- **************************************** -->

<net-petri-def xmlns="http://www.cleda.org/net-petri-def.xsd"
	name="sms-net" doc-type="sms-doc">

	<!-- **************************************** -->
	<!-- The global MetaData -->
	<!-- **************************************** -->

	<meta-data key="java.echo.doc.editor"
		val="com.minotauro.sandbox.gui.dmainsms.FrmDMainSmsEdit" />
	<meta-data key="java.echo.doc.i18n.cls"
		val="com.minotauro.sandbox.gui.dmainsms._I18NFrmDMainSmsEdit" />

	<!-- **************************************** -->
	<!-- The role list and delegators -->
	<!-- **************************************** -->

	<roles-list>
		<role name="enterdoc" delegator="com.minotauro.workflow.impl.WorkflowDelegatorImpl" />
		<role name="check1st" delegator="com.minotauro.workflow.impl.WorkflowDelegatorImpl" />
		<role name="check2nd" delegator="com.minotauro.workflow.impl.WorkflowDelegatorImpl" />
	</roles-list>

	<!-- **************************************** -->
	<!-- The list of places in the net-petri -->
	<!-- **************************************** -->

	<place-list>
		<place name="p0" /> <!-- estao inicial -->
		<place name="p1" /> <!-- mensaje recibido -->
		<place name="p2" /> <!-- mensaje tipo inscripcion -->
		<place name="p3" /> <!-- mensaje tipo consulta -->
		<place name="p4" /> <!-- mensaje tipo suspender -->
		<place name="p5" /> <!-- consulta procesada -->
		<place name="p6" /> <!-- usuario eliminado  -->
		<place name="p7" /> <!-- Sms Enviado -->
		<place name="p8" /> <!-- end cancel -->
	</place-list>

	<!-- **************************************** -->
	<!-- The list of trans-set and trans -->
	<!-- **************************************** -->

	<trans-list>
		<trans-set name="inicio" init="true">
			<role name="enterdoc" />
			<work name="worklist3" />

			<doc-section-state name="remitente" state="editable" />
			<doc-section-state name="tipo sms" state="editable" />
			<doc-section-state name="cuerpo" state="hidden" />
			

			<trans name="inicio">
				<meta-data key="java.echo.doc.i18n.key" val="enterdoc" />

				<pre-place name="p0" />
				<pos-place name="p1" />
			</trans>
		</trans-set>

		<trans-set name="mensajeRecibido">
			<role name="check1st" />
			<work name="worklist3" />

			<doc-section-state name="remitente" state="readonly" />
			<doc-section-state name="tipo sms" state="readonly" />
			<doc-section-state name="cuerpo" state="editable" />
			
			<trans name="inscribir">
				<meta-data key="java.echo.doc.i18n.key" val="deny1st" />

				<doc-section-state name="cuerpo" state="dovalidate" />

				<pre-place name="p1" />
				<pos-place name="p2" />
			</trans>
			<trans name="consultar">
				<meta-data key="java.echo.doc.i18n.key" val="accept1st" />

				<doc-section-state name="cuerpo" state="novalidate" />

				<pre-place name="p1" />
				<pos-place name="p3" />
			</trans>
			<trans name="suspender">
				<meta-data key="java.echo.doc.i18n.key" val="saveTmp" />

				<doc-section-state name="cuerpo" state="novalidate" />

				<pre-place name="p1" />
				<pos-place name="p4" />
			</trans>
		</trans-set>

		<trans-set name="UsuarioInscrito">
			<!-- TODO: Timed Transitions are crashing -->
			<auto type="com.minotauro.workflow.test.base.DummyOneTransAgent"
				time="0" />

			<trans name="enviarSmsInscripcion">
				<pre-place name="p2" />
				<pos-place name="p7" />
			</trans>
		</trans-set>

		<trans-set name="EjecutarConsulta">
			<role name="check2nd" />
			<work name="worklist3" />

			<doc-section-state name="remitente" state="readonly" />
			<doc-section-state name="tipo sms" state="readonly" />
			<doc-section-state name="cuerpo" state="readonly" />

			<trans name="consultando">
				<meta-data key="java.echo.doc.i18n.key" val="deny2nd" />

				<pre-place name="p3" />
				<pos-place name="p5" />
			</trans>
		
		</trans-set>

		<trans-set name="consultaProcesada">
			<auto type="com.minotauro.workflow.test.base.DummyOneTransAgent"
				time="0" />

			<trans name="enviarSmsConsulta">
				<pre-place name="p5" />
				<pos-place name="p7" />
			</trans>
		</trans-set>
		
		<trans-set name="Eliminar">
			<role name="check2nd" />
			<work name="worklist3" />

			<doc-section-state name="remitente" state="readonly" />
			<doc-section-state name="tipo sms" state="readonly" />
			<doc-section-state name="cuerpo" state="readonly" />
			
			
			<trans name="eliminando">
			<meta-data key="java.echo.doc.i18n.key" val="delete" />
				<pre-place name="p4" />
				<pos-place name="p6" />
			</trans>
		</trans-set>
		
		<trans-set name="UsuarioEliminado">
		<auto type="com.minotauro.workflow.test.base.DummyOneTransAgent"
				time="0" />

			<trans name="enviarSmsUEliminado">
				<pre-place name="p6" />
				<pos-place name="p7" />
			</trans>
		</trans-set>
		
		

		

		
	</trans-list>

	<!-- **************************************** -->
	<!-- The list of states in the net-petri -->
	<!-- **************************************** -->

	<state-list>
		<state-grp name="enterdoc" terminal="false">
			<state-set name="enterdoc">
				<place name="p0" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="wait-for-1st" terminal="false">
			<doc-section-state name="remitente" state="visible" />
			<doc-section-state name="tipo sms" state="visible" />
			<doc-section-state name="cuerpo" state="visible" />
			

			<state-set name="wait-for-1st">
				<place name="p1" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="wait-for-2nd" terminal="false">
			<doc-section-state name="remitente" state="visible" />
			<doc-section-state name="tipo sms" state="visible" />
			<doc-section-state name="cuerpo" state="visible" />
			
			<state-set name="wait-for-2nd">
				<place name="p3" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="deny-mail-1" terminal="false">
			<state-set name="deny-mail-1">
				<place name="p2" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="deny-mail-2" terminal="false">
			<state-set name="deny-mail-2">
				<place name="p5" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="deny" terminal="true">
			<doc-section-state name="remitente" state="visible" />
			<doc-section-state name="tipo sms" state="visible" />
			<doc-section-state name="cuerpo" state="visible" />
			

			<state-set name="deny">
				<place name="p4" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="accept-mail" terminal="false">
			<doc-section-state name="remitente" state="visible" />
			<doc-section-state name="tipo sms" state="visible" />
			<doc-section-state name="cuerpo" state="hidden" />
			

			<state-set name="accept-mail">
				<place name="p6" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="accept" terminal="true">
			<state-set name="accept">
				<place name="p7" tokens="1" />
			</state-set>
		</state-grp>
		<state-grp name="cancel" terminal="true">
			<state-set name="cancel">
				<place name="p8" tokens="1" />
			</state-set>
		</state-grp>
	</state-list>

</net-petri-def>
